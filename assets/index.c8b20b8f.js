var r=Object.defineProperty;var c=(i,t,s)=>t in i?r(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var l=(i,t,s)=>(c(i,typeof t!="symbol"?t+"":t,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function s(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=s(n);fetch(n.href,a)}})();const log=console.log.bind(console,"---Log:"),e=i=>document.querySelector(i),es=i=>Array.from(document.querySelectorAll(i)),bindAll=(i,t,s)=>{let o=es(i);for(let n=0;n<o.length;n++)o[n].addEventListener(t,h=>{s(h)})},aInb=(i,t,s)=>i>=t&&i<=s,randomBetween=(i,t)=>{let s=Math.random()*(t-i+1);return Math.floor(s+i)},templateAlert=i=>`
    <div class="alert">
      <div>game over</div>
      <div>
        <span>score: </span>
        <span>${i}</span>
      </div> 
      <div>
        <span>your best score: </span>
        <span class="high-score">0</span>
      </div>
      <div class="again">play again</div>
    </div>
  `,insertAlert=i=>{let t=templateAlert(i);document.body.insertAdjacentHTML("beforeend",t)},compare=(i,t)=>i>t,saveLocalStorage=(i,t)=>{localStorage.setItem(`${i}`,`${t}`)};class CyjGame{constructor(t,s,o){l(this,"registerAction",(t,s)=>{this.actions[t]=s});window.fps=t,this.images=s,this.runCallback=o,this.scene=null,this.actions={},this.keydowns={},this.canvas=document.querySelector("#id-canvas"),this.context=this.canvas.getContext("2d");let n=this;window.addEventListener("keydown",a=>{this.keydowns[a.key]="down"}),window.addEventListener("keyup",function(a){n.keydowns[a.key]="up"}),this.init()}static instance(...t){return this.i=this.i||new this(...t),this.i}drawImage(t){this.context.drawImage(t.texture,t.x,t.y,t.w,t.h)}update(){this.scene.update()}draw(){this.scene.draw()}runLoop(){this.keyActions(),this.update(),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.draw(),requestAnimationFrame(()=>{this.runLoop()})}keyActions(){Object.keys(this.actions);for(const t in this.actions){let s=this.keydowns[t];s==="down"?this.actions[t]("down"):s==="up"&&(this.actions[t]("up"),this.keydowns[t]=null)}}textureByName(t){log(this.images,"this.images"),log(t,"name");let s=this.images[t];return log(this,"this"),s}runWithScene(t){this.scene=t,this.runLoop()}replaceScene(t){this.scene=t}__start(t){this.runCallback(this)}init(){let t=[],s=this.images,o=Object.keys(this.images);for(const n in s){const a=this.images[n],h=new Image;h.src=a,h.onload=()=>{this.images[n]=h,log("hello \u8F7D\u5165\u56FE\u7247",t.length,this.images),t.push(1),t.length===o.length&&(log("hello \u8F7D\u5165\u56FE\u7247"),this.__start())}}}}class CyjScene{constructor(t){this.game=t,this.debugModeEnabled=!0,this.elements=[]}static new(t){return new this(t)}addElement(t){t.scene=this,this.elements.push(t)}removeElement(){for(let t=0;t<this.elements.length;t++)this.elements[t].alive===!1&&(log("\u5220\u9664\u7684\u5143\u7D20",this.elements[t]),this.elements.splice(t,1))}draw(){for(let t=0;t<this.elements.length;t++)this.elements[t].draw()}update(){if(!window.paused){if(this.debug&&this.debug(),this.debugModeEnabled)for(let t=0;t<this.elements.length;t++){const s=this.elements[t];s.debug&&s.debug()}for(let t=0;t<this.elements.length;t++)this.elements[t].update()}}}class CyjImage{constructor(t,s,o,n){this.game=t,this.texture=t.textureByName(s),this.x=0,this.y=0,this.w=o||this.texture.width,this.h=n||this.texture.height,this.rotation=0}static new(t,s,o,n){return new this(t,s,o,n)}draw(){this.game.drawImage(this)}update(){}}class Ball extends CyjImage{constructor(t,s,o,n){super(t,s,o,n),this.game=t,this.setup()}static new(t,s){return new this(t,s)}setup(){this.isActive=!1,this.isAlive=!0,this.gy=0,this.vy=0,this.jumpHeight=30,this.y=0,this.vx=0,this.fr=.98}setupActive(){this.isActive&&(this.gy=2)}jump(){this.vy=-this.jumpHeight}draw(){this.game.context.drawImage(this.texture,this.x,this.y)}addFriction(){this.vx*=this.fr,this.vy*=this.fr}handleBoundary(){(this.x<=0||this.x>=window.w-this.w)&&(window.w-this.x>this.x-0?this.x=1:this.x=window.w-1-this.w,this.vx*=-1),this.y<=0&&(this.y=1,this.vy*=-1)}update(){this.setupActive(),this.handleBoundary(),this.isAlive&&(this.y+=this.vy,this.vy+=this.gy*.1,this.x+=this.vx),this.resetJump(),this.addFriction()}resetJump(){this.isAlive||(this.jumpHeight=25)}}class CyjRect{constructor(t,s,o,n,a,h="black"){console.log(o),this.game=t,this.x=s,this.y=o,this.width=n,this.height=a,this.color=h}static new(t,s,o,n,a,h){return new this(t,s,o,n,a,h)}draw(){this.game.context.fillStyle=this.color,this.game.context.fillRect(this.x,this.y,this.width,this.height)}update(){}}class SceneTitle extends CyjScene{constructor(t){super(t),this.setup(),this.registerEvent()}setup(){this.lineY=window.h-300,this.score=0,this.power=.01,this.vxRange=20,this.isAlert=!0,this.setupBackground(),this.setupLine(),this.setupBird(),this.setupInputs()}setupBackground(){let t=this,s=CyjImage.new(t.game,"bg",window.w,window.h);s.y=-80,this.addElement(s)}setupLine(){let t=this.lineY,s=new CyjRect(this.game,0,t,window.w,2);this.addElement(s)}setupBird(){let t=this;this.birdSpeed=2;let s=Ball.new(t.game,"ball",200,200);s.x=180,s.y=200,this.b=s,this.addElement(s)}setupInputs(){}debug(){}update(){super.update(),this.isFail()}isFail(){this.b.y+this.b.h>=window.h&&(log(this.score,"this.score"),this.highScore(),this.b.isAlive=!1,this.b.vx=0,this.b.vy=0,this.b.y=window.h-this.b.h,this.addAlert())}actionTouch(t){let s;if(this.b.isActive=!0,!!this.b.isAlive&&(t.changedTouches?s={x:t.changedTouches[0].clientX-window.canvasRect.left,y:t.changedTouches[0].clientY-window.canvasRect.top,w:10,h:10}:s={x:t.clientX,y:t.clientY,w:10,h:10},log(window.canvasRect.left,"window.canvasRect.left"),log(s,"point"),this.collide(s)&&s.y>this.lineY)){this.vxRange+=this.power*10;let o=-1-this.power;log(this.vxRange,"range");let n=randomBetween(-this.vxRange,this.vxRange);this.b.vy=o,this.b.vx=-n,this.b.jump(),this.b.jumpHeight+=this.power,this.plusOne(),this.addPower()}}registerEvent(){e("#id-canvas").addEventListener("touchstart",t=>{this.actionTouch(t)}),e("#id-canvas").addEventListener("click",t=>{this.actionTouch(t)}),document.body.addEventListener("click",t=>{t.target.classList.contains("again")&&(this.again(),e(".alert").remove())})}again(){this.score=0,this.vxRange=20,this.power=.01,this.b.x=180,this.b.y=200,this.b.gy=2,this.b.isActive=!0,this.b.isAlive=!0,this.isAlert=!0,e("#id-scroll").innerText=this.score,log(this.vxRange,"this.vxRange")}addPower(){this.power+=.05}addAlert(){this.isAlert&&(insertAlert(this.score),e(".high-score").innerText=localStorage.getItem("score"),this.isAlert=!1)}collide(t){let s=t,o=this.b;return!!((aInb(s.x,o.x,o.x+o.w)||aInb(o.x,s.x,s.x+s.w))&&(aInb(s.y,o.y,o.y+o.h)||aInb(o.y,s.y,s.y+s.h)))}plusOne(){this.score+=1,e("#id-scroll").innerText=this.score}highScore(t){let s=localStorage.getItem("score");compare(this.score,s)&&saveLocalStorage("score",this.score)}}const ball=""+new URL("ball.c6e9289c.png",import.meta.url).href,bg=""+new URL("background.4d21ec40.png",import.meta.url).href,config={};window.paused=!1;window.canvasRect=e("#id-canvas").getBoundingClientRect();window.score=0;const init=()=>{localStorage.getItem("score")||saveLocalStorage("score",0),window.w=window.innerWidth,window.h=window.innerHeight,e("canvas").width=window.w,e("canvas").height=window.h},enableDebugMode=function(i,t){!t||window.addEventListener("keydown",s=>{log("hello"),s.key==="p"&&(log(window.paused),window.paused=!window.paused)})},templateControl=(i,t)=>`
                <div class="">
                    <label>
                        <input class="cyj-auto-slider"
                               type="range"
                               max="${t.max}"
                               min="${t.min}"
                               value="${t.value}"
                               data-value="config.${i}"
                        >
                        ${t._comment}: <span class="cyj-label"></span>
                    </label>
                </div>
            `,insertControls=()=>{let i=e(".cyj-controls"),t=Object.keys(config);for(const s of t){let o=config[s],n=templateControl(s,o);i.insertAdjacentHTML("beforeend",n)}},bindEvents=()=>{bindAll(".cyj-auto-slider","input",event=>{let target=event.target;log(target,"target");let bindValue=target.dataset.value;log(bindValue,"bindValue");let v=target.value;log(v,"v"),eval(bindValue+".value ="+v);let label=target.closest("label").querySelector(".cyj-label");label.innerText=v})},__main=()=>{init();const i={bg,ball},t=CyjGame.instance(30,i,s=>{let o=new SceneTitle(s);s.runWithScene(o)});enableDebugMode(t,!0),insertControls(),bindEvents()};__main();
